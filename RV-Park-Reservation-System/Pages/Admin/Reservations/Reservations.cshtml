@page
@model RV_Park_Reservation_System.Pages.Admin.ReservationsModel
@{
    ViewData["Title"] = "Reservations";
}

<div class="container">
    <h1 class="display-4 text-center text-primary my-5">RESERVATIONS</h1>
    <!--TODO: MANAGE RESERVATIONS-->
    <div class="border backgroundWhite mt-5 p-3">
        <div class="row mt-3">
            <div class="col-6">
                <h2 class="text-primary">Reservations</h2>
            </div>
            <div class="col-6 text-right">
                <a asp-page="/Admin/Reservations/Reservations" asp-area="Identity" class="btn btn-primary"><i class="fas fa-plus"></i> &nbsp; Create New Reservation</a>
            </div>
        </div>
        <br /><br />
        <p class="hidden" id="success">@Model.Success.ToString()</p>
        <p class="hidden" id="message">@Model.Message</p>
        <table class="table table-striped table-bordered" style="width:100%">
            <thead>
                <tr>
                    <th scope="col">Reservation #</th>
                    <th scope="col">Customer Name</th>
                    <th scope="col">Site Number</th>
                    <th scope="col">Start Date</th>
                    <th scope="col">End Date</th>
                    <th scope="col">Customer Phone #</th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody>
                @{
                    foreach (var reservation in Model.ReservationList)
                    {
                        <tr>
                            <td id="reservationID">@reservation.ResID</td>
                            <td>@reservation.Customer.CustFirstName  @reservation.Customer.CustLastName</td>
                            <td>@reservation.SiteID</td>
                            <td>@reservation.ResStartDate</td>
                            <td>@reservation.ResEndDate</td>
                            <td>@reservation.Customer.CustPhone</td>
                            <td>
                                <form method="post">
                                    <a class="btn btn-success text-light" asp-page="/Admin/Reservations/ReservationsUpdate" asp-route-id="@reservation.ResID" asp-route-userId="@reservation.Customer.Id">Update</a>
                                    <a class="btn btn-danger text-light" onclick="return deleteRecord(@reservation.ResID, event)" asp-page="/Admin/Reservations/ReservationsDelete" asp-route-id="@reservation.ResID">Delete</a>
                                    <input type="hidden" value="@reservation.ResID" />
                                    <input type="hidden" value="@reservation.Customer.Id" />
                                </form>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts{
    <script type="text/javascript">
        function deleteRecord(reservation, e) {
            //e.preventDefault();
            // current problem: Same one as before, the swal isn't waiting before sending the page to the delete, but the delete won't work without the asp-page-route.
            // the fix from before wont' work because the Reservations page itself uses the onPost to route to the update page, so we can't overwrite it to use the OnPost.
            // need to devise a way to prevent the page from changing but then still allow the page to be routed after selecting an option.
            // (possibly weird) idea: in Reservation onPost, make it take 2 values, id and direction. Then do if check to determine where to route the page. 
            swal({
                title: "Are you sure you want to delete?",
                text: "You will not be able to restore this data!",
                icon: "warning",
                buttons: true,
                dangerMode: true
            }).then(function (willDelete) {
                if (willDelete) {
                    //location.href = "/Admin/Reservations/ReservationsDelete?id="${ reservation };
                    return true;
                }
                else {
                    return false;
                }
            })
        }
    </script>
<script>
    function alertFunc() {
                var success = $("#success").html()
                var message = $("#message").html();
                console.log(success);
                console.log(message);
                if (success == "True") {
                    toastr.success(message);
                };
            }
        window.onload = alertFunc();
</script>
}